# Epic: 프로젝트 기반 구조요청 관리 시스템

## 개요
프로젝트 단위로 구조요청을 그룹화하고 관리할 수 있는 시스템을 구축합니다. 각 프로젝트는 고유한 요청 URL을 가지며, 사용자는 해당 URL을 통해 특정 프로젝트에 연결된 구조요청을 생성할 수 있습니다.

## 목적
- 여러 이벤트/프로젝트를 독립적으로 관리
- 프로젝트별 구조요청 통계 및 분석
- 프로젝트 기간 동안만 요청 URL 활성화
- 프로젝트별 담당 구조대원 관리

## 사용자 스토리

### US-1: 관리자의 프로젝트 생성
**As an** 관리자
**I want to** 새로운 프로젝트를 생성하고
**So that** 특정 이벤트나 기간 동안의 구조요청을 독립적으로 관리할 수 있다

**인수 조건:**
- 프로젝트 이름, 설명, 시작일, 종료일을 입력할 수 있다
- 프로젝트 생성 시 고유한 URL이 자동으로 생성된다
- 생성된 URL을 복사하여 공유할 수 있다

### US-2: 프로젝트 목록 및 관리
**As an** 관리자
**I want to** 모든 프로젝트를 목록으로 보고 관리하고
**So that** 진행 중인/완료된 프로젝트를 한눈에 파악할 수 있다

**인수 조건:**
- 프로젝트 목록을 테이블 형태로 볼 수 있다
- 각 프로젝트의 구조요청 통계(대기/진행/완료)를 확인할 수 있다
- 프로젝트 상태(진행 중/종료)를 시각적으로 구분할 수 있다
- 프로젝트를 수정/삭제할 수 있다

### US-3: 프로젝트별 구조요청 조회
**As an** 관리자
**I want to** 특정 프로젝트에 속한 구조요청만 필터링하여 보고
**So that** 프로젝트별 구조활동을 집중적으로 관리할 수 있다

**인수 조건:**
- 프로젝트를 선택하면 해당 프로젝트의 구조요청만 표시된다
- 지도 뷰에서도 프로젝트별 필터링이 적용된다
- 프로젝트별 통계가 자동으로 계산된다

### US-4: 사용자의 프로젝트 URL 접근
**As a** 일반 사용자
**I want to** 프로젝트 전용 URL에 접속하여
**So that** 특정 이벤트에 대한 구조요청을 빠르게 생성할 수 있다

**인수 조건:**
- 프로젝트 URL로 접속하면 자동으로 해당 프로젝트와 연결된다
- 프로젝트 이름과 설명이 요청 페이지에 표시된다
- 프로젝트가 종료되었거나 비활성화된 경우 안내 메시지가 표시된다

### US-5: 프로젝트 통계 및 리포트
**As an** 관리자
**I want to** 프로젝트별 상세 통계를 확인하고
**So that** 프로젝트 성과를 분석하고 보고할 수 있다

**인수 조건:**
- 프로젝트 대시보드에서 요청 현황을 확인할 수 있다
- 시간대별/일별 요청 추이를 그래프로 볼 수 있다
- 담당자별 처리 현황을 확인할 수 있다

## 기능 요구사항

### 1. 프로젝트 관리 (CRUD)
- **생성**: 프로젝트 생성 시 고유 slug/token 자동 생성
- **조회**: 프로젝트 목록, 상세 정보, 통계
- **수정**: 프로젝트 정보 수정 (이름, 설명, 기간, 상태)
- **삭제**: 프로젝트 삭제 (소프트 삭제 권장)

### 2. URL 생성 및 관리
- 고유한 프로젝트 slug 생성 (예: `/request/project-slug`)
- URL 복사 기능
- QR 코드 생성 기능
- URL 단축 기능 (선택사항)

### 3. 프로젝트 상태 관리
- **진행 중**: 시작일~종료일 사이
- **예정**: 시작일 이전
- **종료**: 종료일 이후
- **비활성화**: 수동으로 비활성화

### 4. 프로젝트별 필터링
- 구조요청 목록에서 프로젝트 필터
- 대시보드 통계에 프로젝트 필터 적용
- 지도 뷰에서 프로젝트 필터 적용

### 5. 권한 관리
- 관리자: 모든 프로젝트 CRUD
- 구조대원: 배정된 프로젝트의 요청만 조회/관리
- 일반 사용자: 프로젝트 URL을 통한 요청 생성

## 데이터 모델

### Projects 테이블
```php
Schema::create('projects', function (Blueprint $table) {
    $table->id();
    $table->string('name');                    // 프로젝트 이름
    $table->string('slug')->unique();          // URL용 고유 식별자
    $table->text('description')->nullable();   // 설명
    $table->date('start_date');                // 시작일
    $table->date('end_date');                  // 종료일
    $table->boolean('is_active')->default(true); // 활성화 상태
    $table->string('status')->default('pending'); // pending/active/completed
    $table->json('settings')->nullable();      // 추가 설정 (색상, 아이콘 등)
    $table->foreignId('created_by')->constrained('users'); // 생성자
    $table->timestamps();
    $table->softDeletes();
});
```

### Requests 테이블 수정
```php
Schema::table('requests', function (Blueprint $table) {
    $table->foreignId('project_id')
        ->nullable()
        ->constrained('projects')
        ->onDelete('cascade');
});
```

### Project-User 관계 테이블 (선택사항)
```php
Schema::create('project_user', function (Blueprint $table) {
    $table->id();
    $table->foreignId('project_id')->constrained()->onDelete('cascade');
    $table->foreignId('user_id')->constrained()->onDelete('cascade');
    $table->string('role')->default('member'); // manager/member
    $table->timestamps();

    $table->unique(['project_id', 'user_id']);
});
```

## API 엔드포인트

### 프로젝트 관리
- `GET /admin/projects` - 프로젝트 목록
- `GET /admin/projects/create` - 프로젝트 생성 폼
- `POST /admin/projects` - 프로젝트 생성
- `GET /admin/projects/{id}` - 프로젝트 상세
- `GET /admin/projects/{id}/edit` - 프로젝트 수정 폼
- `PATCH /admin/projects/{id}` - 프로젝트 수정
- `DELETE /admin/projects/{id}` - 프로젝트 삭제

### 프로젝트 통계
- `GET /admin/projects/{id}/stats` - 프로젝트 통계
- `GET /admin/projects/{id}/requests` - 프로젝트별 구조요청 목록

### 사용자 요청
- `GET /requests/create/{slug}` - 프로젝트 전용 요청 페이지
- `POST /api/requests` - 요청 생성 (project_id 포함)

## UI/UX 요구사항

### 1. 프로젝트 목록 페이지 (`/admin/projects`)
```
┌─────────────────────────────────────────────────────────┐
│  구조요청 프로젝트 관리                     [+ 새 프로젝트]  │
├─────────────────────────────────────────────────────────┤
│  검색: [____________]  상태: [전체 ▼]  [검색]            │
├─────────────────────────────────────────────────────────┤
│  프로젝트명    │  기간         │  요청수  │  상태  │  작업  │
│  ─────────────┼──────────────┼────────┼──────┼───────│
│  🔵 행사 A    │  2025-01-01  │  45건  │ 진행중 │ [상세]│
│               │  ~ 01-03     │        │       │ [수정]│
│  ⚫ 행사 B    │  2024-12-20  │  123건 │ 완료  │ [상세]│
│               │  ~ 12-25     │        │       │ [수정]│
└─────────────────────────────────────────────────────────┘
```

### 2. 프로젝트 생성/수정 폼
- 프로젝트 이름 (필수)
- 설명 (선택)
- 시작일/종료일 (필수)
- 활성화 여부
- 생성 후 URL 자동 생성 및 표시
- URL 복사 버튼
- QR 코드 표시

### 3. 프로젝트 상세 페이지
- 프로젝트 정보 카드
- 통계 대시보드 (대기/진행/완료 요청 수)
- 프로젝트 URL 공유 섹션
- 구조요청 목록 (필터링 적용)
- 지도 뷰

### 4. 구조요청 목록 필터
- 기존 필터에 "프로젝트" 선택 옵션 추가
- "모든 프로젝트" / "프로젝트 없음" / 개별 프로젝트 선택

### 5. 사용자 요청 페이지
- 프로젝트 정보 표시 영역 추가
- 프로젝트 이름과 설명 표시
- 프로젝트 종료 시 안내 메시지

## 기술적 요구사항

### 1. 백엔드 (Laravel)
- `Project` 모델 생성
- `ProjectController` 생성
- 요청 생성 시 프로젝트 연결 로직
- 프로젝트별 통계 쿼리 최적화
- Slug 자동 생성 (Str::slug() 사용)

### 2. 프론트엔드
- Vue.js 컴포넌트: 프로젝트 선택 드롭다운
- 프로젝트 필터 상태 관리
- URL 복사 기능
- QR 코드 생성 라이브러리 통합

### 3. 데이터베이스
- 마이그레이션 생성
- 외래 키 제약조건 설정
- 인덱스 최적화 (slug, project_id)

### 4. 검증 및 제약
- 종료일은 시작일보다 이후여야 함
- Slug 중복 방지
- 프로젝트 삭제 시 연결된 요청 처리 정책

## 구현 계획

### Phase 1: 기본 프로젝트 관리 (Week 1)
- [ ] 데이터베이스 마이그레이션 생성
- [ ] Project 모델 및 관계 설정
- [ ] ProjectController CRUD 구현
- [ ] 프로젝트 목록 페이지 UI
- [ ] 프로젝트 생성/수정 폼

### Phase 2: URL 생성 및 요청 연결 (Week 1-2)
- [ ] Slug 자동 생성 로직
- [ ] 프로젝트 전용 요청 페이지 라우트
- [ ] 요청 생성 시 project_id 저장
- [ ] URL 복사 기능
- [ ] 프로젝트 정보 표시

### Phase 3: 프로젝트별 필터링 (Week 2)
- [ ] 구조요청 목록 프로젝트 필터 추가
- [ ] 지도 뷰 프로젝트 필터 적용
- [ ] 대시보드 통계 프로젝트 필터
- [ ] 프로젝트 선택 드롭다운 컴포넌트

### Phase 4: 통계 및 대시보드 (Week 2-3)
- [ ] 프로젝트 상세 페이지
- [ ] 프로젝트별 통계 쿼리
- [ ] 프로젝트 대시보드 UI
- [ ] 차트/그래프 통합

### Phase 5: 고급 기능 (Week 3+)
- [ ] QR 코드 생성
- [ ] 프로젝트 상태 자동 관리 (기간 기반)
- [ ] 프로젝트-사용자 권한 관리
- [ ] 프로젝트 템플릿 기능
- [ ] 프로젝트 복제 기능

## 마일스톤

### M1: 기본 프로젝트 CRUD (Week 1 완료)
- 프로젝트 생성/조회/수정/삭제
- 프로젝트 목록 페이지

### M2: 프로젝트 URL 및 요청 연결 (Week 2 완료)
- 프로젝트 URL 생성
- 사용자가 프로젝트 URL로 요청 생성

### M3: 프로젝트별 필터링 (Week 2 완료)
- 모든 페이지에서 프로젝트 필터 적용

### M4: 통계 및 리포트 (Week 3 완료)
- 프로젝트 대시보드 완성

## 테스트 계획

### 단위 테스트
- Project 모델 메서드 테스트
- Slug 생성 로직 테스트
- 프로젝트 상태 계산 테스트

### 통합 테스트
- 프로젝트 CRUD API 테스트
- 프로젝트 URL을 통한 요청 생성 테스트
- 프로젝트 필터링 테스트

### E2E 테스트
- 관리자 프로젝트 생성 플로우
- 사용자 프로젝트 URL 접근 플로우
- 프로젝트별 구조요청 관리 플로우

## 보안 고려사항
- 프로젝트 URL은 추측하기 어려운 slug 사용
- 비활성화/종료된 프로젝트 접근 제한
- 프로젝트별 권한 검증
- 프로젝트 삭제 시 연결된 데이터 처리

## 성능 고려사항
- 프로젝트별 통계 쿼리 최적화 (캐싱)
- project_id 인덱스 추가
- Eager loading으로 N+1 쿼리 방지

## 향후 확장 가능성
- 프로젝트 템플릿 시스템
- 프로젝트별 커스텀 필드
- 프로젝트별 알림 설정
- 프로젝트 아카이브 기능
- 멀티 테넌시 지원

## 참고 자료
- Laravel 프로젝트 구조: https://laravel.com/docs/eloquent-relationships
- Slug 생성: https://laravel.com/docs/helpers#method-str-slug
- QR 코드: https://github.com/SimpleSoftwareIO/simple-qrcode
